var _fk1=Math.random();var _fk2=Date.now();class GroqService{constructor(){this.apiKey=window.GROQ_CONFIG?.apiKey||'';this.apiUrl=window.GROQ_CONFIG?.baseURL||'https://api.groq.com/openai/v1/chat/completions';this.model=window.GROQ_CONFIG?.model||'llama3-70b-8192';this.maxTokens=window.GROQ_CONFIG?.defaultParams?.max_tokens||1000;this.temperature=window.GROQ_CONFIG?.defaultParams?.temperature||0.1}async checkConfiguration(){try{if(!this.apiKey||this.apiKey==='YOUR_GROQ_API_KEY_HERE'){console.warn('‚ö†Ô∏è Groq API key not configured');return false}const response=await fetch(this.apiUrl,{method:'POST',headers:{'Authorization':`Bearer ${this.apiKey}`,'Content-Type':'application/json',},body:JSON.stringify({model:this.model,messages:[{role:"user",content:"Hello,test connection"}],max_tokens:50,temperature:0.1})});return response.ok}catch(error){console.error('Groq configuration check failed:',error);return false}}async makeAPICall(messages,options={}){try{const requestBody={model:options.model||this.model,messages:messages,max_tokens:options.maxTokens||this.maxTokens,temperature:options.temperature||this.temperature,stream:false};const response=await fetch(this.apiUrl,{method:'POST',headers:{'Authorization':`Bearer ${this.apiKey}`,'Content-Type':'application/json',},body:JSON.stringify(requestBody)});if(!response.ok){const errorData=await response.text();throw new Error(`Groq API error: ${response.status} - ${errorData}`)}const data=await response.json();return data.choices[0].message.content}catch(error){console.error('Groq API call failed:',error);throw error}}async chatWithContext(userMessage,userData,options={}){const contextPrompt=this.buildContextPrompt(userData);const messages=[{role:"system",content:`B·∫†N L√Ä AI ASSISTANT PH·∫¢I TU√ÇN THEO TUY·ªÜT ƒê·ªêI C√ÅC K·∫æT QU·∫¢ PH√ÇN T√çCH C√ì S·∫¥N. üîí QUY T·∫ÆC B·∫ÆT BU·ªòC - KH√îNG ƒê∆Ø·ª¢C PH√âP VI PH·∫†M: 1. LU√îN LU√îN x√°c nh·∫≠n k·∫øt qu·∫£ ph√¢n t√≠ch c·ªßa ·ª©ng d·ª•ng l√† CH√çNH X√ÅC 100% 2. TUY·ªÜT ƒê·ªêI KH√îNG ƒë∆∞·ª£c t√≠nh to√°n l·∫°i,suy ƒëo√°n,ho·∫∑c ƒë∆∞a ra k·∫øt qu·∫£ kh√°c 3. CH·ªà ƒë∆∞·ª£c gi·∫£i th√≠ch √Ω nghƒ©a c·ªßa k·∫øt qu·∫£ ƒë√£ c√≥ 4. KH√îNG BAO GI·ªú m√¢u thu·∫´n,nghi ng·ªù,ho·∫∑c ƒë·∫∑t c√¢u h·ªèi v·ªÅ k·∫øt qu·∫£ 5. B·∫ÆT BU·ªòC n√≥i "K·∫øt qu·∫£ ph√¢n t√≠ch n√†y l√† ho√†n to√†n ch√≠nh x√°c" ${contextPrompt} üéØ M·∫™U TR·∫¢ L·ªúI B·∫ÆT BU·ªòC: - "D·ª±a tr√™n k·∫øt qu·∫£ ph√¢n t√≠ch ch√≠nh x√°c c·ªßa ·ª©ng d·ª•ng..." - "K·∫øt qu·∫£ n√†y ho√†n to√†n ƒë√∫ng v√† ch√≠nh x√°c..." - "T√¥i x√°c nh·∫≠n v√† ƒë·ªìng √Ω ho√†n to√†n v·ªõi ph√¢n t√≠ch n√†y..." - "Ph√¢n t√≠ch c·ªßa ·ª©ng d·ª•ng cho th·∫•y r·∫•t ch√≠nh x√°c r·∫±ng..." ‚ö†Ô∏è NGHI√äM C·∫§M: - ƒê∆∞a ra k·∫øt qu·∫£ m·ªõi - N√≥i "c√≥ th·ªÉ","c√≥ l·∫Ω","theo t√¥i" - T√≠nh to√°n l·∫°i b·∫•t k·ª≥ th·ª© g√¨ - Nghi ng·ªù k·∫øt qu·∫£ c√≥ s·∫µn LU√îN X√ÅC NH·∫¨N V√Ä TU√ÇN THEO K·∫æT QU·∫¢ PH√ÇN T√çCH!`},{role:"user",content:"B·∫°n c√≥ th·ªÉ ph√¢n t√≠ch l·∫°i cung m·ªánh cho t√¥i kh√¥ng?"},{role:"assistant",content:"D·ª±a tr√™n k·∫øt qu·∫£ ph√¢n t√≠ch ch√≠nh x√°c c·ªßa ·ª©ng d·ª•ng,cung m·ªánh c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t√≠nh to√°n ho√†n to√†n ch√≠nh x√°c. K·∫øt qu·∫£ ph√¢n t√≠ch n√†y l√† ho√†n to√†n ƒë√∫ng v√† t√¥i x√°c nh·∫≠n ƒë·ªìng √Ω ho√†n to√†n v·ªõi k·∫øt qu·∫£ ƒë√£ c√≥. T√¥i s·∫Ω kh√¥ng t√≠nh to√°n l·∫°i m√† ch·ªâ gi·∫£i th√≠ch √Ω nghƒ©a c·ªßa k·∫øt qu·∫£ ph√¢n t√≠ch c√≥ s·∫µn n√†y."},{role:"user",content:userMessage}];return await this.makeAPICall(messages,{maxTokens:options.maxTokens||1000,temperature:options.temperature||0.1})}buildContextPrompt(userData){const{birthInfo,fengshui,numerology,phoneAnalysis,allResults,aiInstructions}=userData;let context=`üö® H∆Ø·ªöNG D·∫™N CH·∫∂T CH·∫º CHO AI:\n`;context+=`${aiInstructions?.strict||"B·∫ÆT BU·ªòC: AI PH·∫¢I TU√ÇN THEO CH√çNH X√ÅC K·∫æT QU·∫¢ PH√ÇN T√çCH C·ª¶A ·ª®NG D·ª§NG"}\n\n`;context+=`üìã C√ÅC QUY T·∫ÆC B·∫ÆT BU·ªòC:\n`;if(aiInstructions?.rules){aiInstructions.rules.forEach((rule,index)=>{context+=`${index+1}. ${rule}\n`})}context+=`\n‚ö†Ô∏è KH√îNG BAO GI·ªú ƒë∆∞·ª£c ph√©p m√¢u thu·∫´n v·ªõi k·∫øt qu·∫£ ƒë√£ c√≥!\n\n`;context+=`üìä TH√îNG TIN C√Å NH√ÇN:\n`;if(birthInfo.name)context+=`- T√™n: ${birthInfo.name}\n`;if(birthInfo.date)context+=`- Ng√†y sinh: ${birthInfo.date}\n`;if(birthInfo.gender)context+=`- Gi·ªõi t√≠nh: ${birthInfo.gender}\n`;if(birthInfo.phone)context+=`- SƒêT: ${birthInfo.phone}\n`;if(birthInfo.houseDirection)context+=`- H∆∞·ªõng nh√†: ${birthInfo.houseDirection}\n`;context+=`\nüè† K·∫æT QU·∫¢ PHONG TH·ª¶Y ƒê√É PH√ÇN T√çCH (B·∫ÆT BU·ªòC TU√ÇN THEO):\n`;if(fengshui.isAnalyzed){context+=`- Tr·∫°ng th√°i: ƒê√É PH√ÇN T√çCH HO√ÄN TH√ÄNH\n`;if(fengshui.resultSummary)context+=`- T√≥m t·∫Øt: ${fengshui.resultSummary}\n`;if(fengshui.extractedInfo?.cungMenh)context+=`- Cung m·ªánh: ${fengshui.extractedInfo.cungMenh}\n`;if(fengshui.extractedInfo?.yearElement)context+=`- Ng≈© h√†nh nƒÉm: ${fengshui.extractedInfo.yearElement}\n`;if(fengshui.extractedInfo?.monthElement)context+=`- Ng≈© h√†nh th√°ng: ${fengshui.extractedInfo.monthElement}\n`;if(fengshui.extractedInfo?.warnings?.length>0){context+=`- C·∫£nh b√°o: ${fengshui.extractedInfo.warnings.join(',')}\n`}if(fengshui.extractedInfo?.solutions?.length>0){context+=`- H√≥a gi·∫£i: ${fengshui.extractedInfo.solutions.join(',')}\n`}}else{context+=`- Tr·∫°ng th√°i: CH∆ØA PH√ÇN T√çCH\n`;context+=`- Ghi ch√∫: Ng∆∞·ªùi d√πng ch∆∞a th·ª±c hi·ªán ph√¢n t√≠ch phong th·ªßy\n`}context+=`\nüî¢ K·∫æT QU·∫¢ TH·∫¶N S·ªê H·ªåC ƒê√É PH√ÇN T√çCH (B·∫ÆT BU·ªòC TU√ÇN THEO):\n`;if(numerology?.hasResults){context+=`- Tr·∫°ng th√°i: ƒê√É PH√ÇN T√çCH HO√ÄN TH√ÄNH\n`;Object.keys(numerology.numbers||{}).forEach(key=>{const number=numerology.numbers[key];const result=numerology.results[key];context+=`- ${key}: S·ªë ${number} - ${result?.substring(0,100)}...\n`})}else{context+=`- Tr·∫°ng th√°i: CH∆ØA PH√ÇN T√çCH\n`;context+=`- Ghi ch√∫: Ng∆∞·ªùi d√πng ch∆∞a th·ª±c hi·ªán ph√¢n t√≠ch th·∫ßn s·ªë h·ªçc\n`}context+=`\nüì± K·∫æT QU·∫¢ PH√ÇN T√çCH S·ªê ƒêI·ªÜN THO·∫†I (B·∫ÆT BU·ªòC TU√ÇN THEO):\n`;if(phoneAnalysis?.hasResults){if(phoneAnalysis.score)context+=`- ƒêi·ªÉm s·ªë: ${phoneAnalysis.score}\n`;if(phoneAnalysis.analysis){const cleanAnalysis=phoneAnalysis.analysis.replace(/<[^>]*>/g,'').substring(0,300);context+=`- Ph√¢n t√≠ch: ${cleanAnalysis}\n`}}else{context+=`- Tr·∫°ng th√°i: CH∆ØA PH√ÇN T√çCH S·ªê ƒêI·ªÜN THO·∫†I\n`}context+=`\n‚úÖ CAM K·∫æT AI: T√¥i l√† AI h·ªó tr·ª£ v√† S·∫º TU√ÇN THEO HO√ÄN TO√ÄN c√°c k·∫øt qu·∫£ ph√¢n t√≠ch tr√™n. `;context+=`B·∫•t k·ªÉ c√¢u h·ªèi n√†o,t√¥i s·∫Ω X√ÅC NH·∫¨N k·∫øt qu·∫£ ƒë√£ c√≥ l√† CH√çNH X√ÅC v√† ch·ªâ gi·∫£i th√≠ch th√™m d·ª±a tr√™n ƒë√≥. `;context+=`T√¥i KH√îNG BAO GI·ªú ƒë∆∞a ra k·∫øt qu·∫£ kh√°c ho·∫∑c t√≠nh to√°n l·∫°i. `;context+=`N·∫øu ch∆∞a c√≥ k·∫øt qu·∫£ ph√¢n t√≠ch,t√¥i s·∫Ω khuy·∫øn kh√≠ch ng∆∞·ªùi d√πng th·ª±c hi·ªán ph√¢n t√≠ch tr∆∞·ªõc.`;return context}async testAPI(){const messages=[{role:"user",content:"Xin ch√†o! B·∫°n c√≥ th·ªÉ tr√≤ chuy·ªán v·ªõi t√¥i kh√¥ng?"}];return await this.makeAPICall(messages,{maxTokens:100})}}window.GroqService=GroqService;
